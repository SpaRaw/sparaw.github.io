<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üßµ Grid Overlay Tool f√ºr Kreuzstich</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #4a5568;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .header p {
            color: #718096;
            font-size: 1.1em;
        }

        .controls-section {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .controls-row {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            min-width: 150px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .slider-control {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 10px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            min-width: 200px;
        }

        .slider-control label {
            color: #4a5568;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .slider-control input[type="range"] {
            width: 180px;
            margin: 5px 0;
            height: 6px;
            border-radius: 3px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
        }

        .slider-control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .slider-control input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .slider-value {
            color: #667eea;
            font-weight: bold;
            font-size: 16px;
            margin-top: 5px;
        }

        .image-section {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .image-container {
            position: relative;
            display: inline-block;
            border: 3px solid #4a5568;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .original-image {
            display: block;
            width: 600px;
            height: auto;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        .grid-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .info-section {
            background: #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }

        .info-section h3 {
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .info-section p {
            color: #718096;
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #718096;
            font-size: 0.9em;
        }

        #fileInput {
            display: none;
        }

        .loading {
            text-align: center;
            color: #4a5568;
            font-size: 1.1em;
            margin: 20px 0;
        }

        .loading::after {
            content: '';
            animation: dots 1.5s steps(5, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60% { content: '...'; }
            80%, 100% { content: '....'; }
        }

        @media (max-width: 768px) {
            .original-image {
                width: 100%;
                max-width: 400px;
            }
            
            .controls-section {
                flex-direction: column;
                align-items: center;
            }
            
            .slider-control {
                min-width: 100%;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üßµ Grid Overlay Tool f√ºr Kreuzstich</h1>
            <p>Legen Sie ein pr√§zises Grid √ºber Ihr Bild f√ºr perfekte Kreuzstich-Vorlagen</p>
        </div>

        <div class="controls-section">
            <div class="controls-row">
                <input type="file" id="fileInput" accept="image/*" onchange="handleImageUpload(event)">
                <button class="btn btn-primary" onclick="loadImageFile()">
                    üìÅ Bild laden
                </button>
                <button class="btn btn-secondary" onclick="toggleGrid()">
                    üìê Grid ein/aus
                </button>
                <button class="btn btn-warning" id="wakeLockBtn" onclick="toggleWakeLock()">
                    üîÜ Bildschirm an lassen
                </button>
            </div>
            
            <div class="controls-row">
                <div class="slider-control">
                    <label>üî≤ Grid-Gr√∂√üe</label>
                    <input type="range" id="gridSizeSlider" min="2" max="50" value="10" oninput="updateGridSize(this.value)">
                    <div class="slider-value">
                        <span id="gridSizeValue">10</span> Pixel
                    </div>
                </div>
                
                <div class="slider-control">
                    <label>üì¶ Box-Gr√∂√üe</label>
                    <input type="range" id="boxSizeSlider" min="5" max="50" value="10" oninput="updateBoxSize(this.value)">
                    <div class="slider-value">
                        <span id="boxSizeValue">10</span> x <span id="boxSizeValue2">10</span>
                    </div>
                </div>
            </div>
            
            <div class="controls-row">
                <button class="btn btn-info" onclick="changeGridSize(-1)">üîç- Feiner</button>
                <button class="btn btn-info" onclick="changeGridSize(1)">üîç+ Gr√∂ber</button>
                <button class="btn btn-success" onclick="saveImage()">üíæ Bild speichern</button>
            </div>
        </div>

        <div class="image-section">
            <div class="image-container" id="imageContainer">
                <canvas id="originalCanvas" class="original-image"></canvas>
                <canvas id="gridCanvas" class="grid-overlay"></canvas>
            </div>
        </div>

        <div class="info-section">
            <h3>üìä Bild-Statistiken</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="imageWidth">-</div>
                    <div class="stat-label">Breite (Pixel)</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="imageHeight">-</div>
                    <div class="stat-label">H√∂he (Pixel)</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="gridColumns">-</div>
                    <div class="stat-label">Grid Spalten</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="gridRows">-</div>
                    <div class="stat-label">Grid Zeilen</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="boxColumns">-</div>
                    <div class="stat-label">Box Spalten</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="boxRows">-</div>
                    <div class="stat-label">Box Zeilen</div>
                </div>
            </div>
            
            <p><strong>üí° Tipp:</strong> Das originale Bild bleibt unver√§ndert. Nur das schwarze Grid wird dar√ºber gelegt.</p>
            <p><strong>üìê Grid:</strong> Feine Linien f√ºr einzelne Stiche | <strong>üì¶ Boxen:</strong> Dicke Linien f√ºr Bereiche</p>
        </div>
    </div>

    <script>
        let gridSize = 10;
        let boxSize = 10;
        let gridVisible = true;
        let originalImage = null;
        let wakeLock = null;

        const originalCanvas = document.getElementById('originalCanvas');
        const gridCanvas = document.getElementById('gridCanvas');
        const originalCtx = originalCanvas.getContext('2d');
        const gridCtx = gridCanvas.getContext('2d');

        // Erstelle ein Standard-Placeholder-Bild
        function createPlaceholderImage() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 600;
            canvas.height = 400;
            
            // Erstelle ein sch√∂nes Gradient als Platzhalter
            const gradient = ctx.createLinearGradient(0, 0, 600, 400);
            gradient.addColorStop(0, '#667eea');
            gradient.addColorStop(0.3, '#87CEEB');
            gradient.addColorStop(0.7, '#ADD8E6');
            gradient.addColorStop(1, '#764ba2');
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 600, 400);
            
            // F√ºge dekorative Elemente hinzu
            ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
            for (let i = 0; i < 20; i++) {
                const x = Math.random() * 600;
                const y = Math.random() * 400;
                const size = Math.random() * 30 + 10;
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // F√ºge Text hinzu
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            ctx.font = 'bold 24px Arial';
            ctx.textAlign = 'center';
            ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
            ctx.shadowBlur = 4;
            ctx.fillText('üßµ Laden Sie Ihr Kreuzstich-Bild hoch', 300, 180);
            
            ctx.font = '18px Arial';
            ctx.fillText('um das pr√§zise Grid zu sehen', 300, 220);
            
            return canvas.toDataURL();
        }

        function initializeCanvas() {
            if (!originalImage) {
                const img = new Image();
                img.onload = function() {
                    setupCanvases(this);
                    drawGrid();
                    updateStats();
                };
                img.src = createPlaceholderImage();
            }
        }

        function setupCanvases(img) {
            const containerWidth = Math.min(600, window.innerWidth - 100);
            const aspectRatio = img.height / img.width;
            const containerHeight = containerWidth * aspectRatio;

            // Setup original canvas
            originalCanvas.width = img.width;
            originalCanvas.height = img.height;
            originalCanvas.style.width = containerWidth + 'px';
            originalCanvas.style.height = containerHeight + 'px';
            originalCtx.imageSmoothingEnabled = false;
            originalCtx.drawImage(img, 0, 0);

            // Setup grid canvas
            gridCanvas.width = img.width;
            gridCanvas.height = img.height;
            gridCanvas.style.width = containerWidth + 'px';
            gridCanvas.style.height = containerHeight + 'px';
            gridCtx.imageSmoothingEnabled = false;

            originalImage = img;
        }

        function drawGrid() {
            if (!originalImage) return;

            gridCtx.clearRect(0, 0, gridCanvas.width, gridCanvas.height);
            
            if (!gridVisible) return;

            // Zeichne feine Grid-Linien
            gridCtx.strokeStyle = '#000000';
            gridCtx.lineWidth = 1;
            gridCtx.globalAlpha = 0.6;

            // Vertikale Grid-Linien
            for (let x = 0; x <= gridCanvas.width; x += gridSize) {
                gridCtx.beginPath();
                gridCtx.moveTo(x, 0);
                gridCtx.lineTo(x, gridCanvas.height);
                gridCtx.stroke();
            }

            // Horizontale Grid-Linien
            for (let y = 0; y <= gridCanvas.height; y += gridSize) {
                gridCtx.beginPath();
                gridCtx.moveTo(0, y);
                gridCtx.lineTo(gridCanvas.width, y);
                gridCtx.stroke();
            }

            // Zeichne dickere Box-Linien
            gridCtx.strokeStyle = '#000000';
            gridCtx.lineWidth = 3;
            gridCtx.globalAlpha = 0.9;

            const boxPixelSize = boxSize * gridSize;

            // Vertikale Box-Linien
            for (let x = 0; x <= gridCanvas.width; x += boxPixelSize) {
                gridCtx.beginPath();
                gridCtx.moveTo(x, 0);
                gridCtx.lineTo(x, gridCanvas.height);
                gridCtx.stroke();
            }

            // Horizontale Box-Linien
            for (let y = 0; y <= gridCanvas.height; y += boxPixelSize) {
                gridCtx.beginPath();
                gridCtx.moveTo(0, y);
                gridCtx.lineTo(gridCanvas.width, y);
                gridCtx.stroke();
            }
        }

        function toggleGrid() {
            gridVisible = !gridVisible;
            const btn = event.target;
            btn.textContent = gridVisible ? 'üìê Grid ein/aus' : 'üìê Grid aktivieren';
            btn.style.background = gridVisible ? 
                'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)' : 
                'linear-gradient(135deg, #10b981 0%, #059669 100%)';
            drawGrid();
        }

        function changeGridSize(delta) {
            gridSize = Math.max(2, Math.min(50, gridSize + delta));
            document.getElementById('gridSizeSlider').value = gridSize;
            document.getElementById('gridSizeValue').textContent = gridSize;
            drawGrid();
            updateStats();
        }

        function updateGridSize(value) {
            gridSize = parseInt(value);
            document.getElementById('gridSizeValue').textContent = gridSize;
            drawGrid();
            updateStats();
        }

        function updateBoxSize(value) {
            boxSize = parseInt(value);
            document.getElementById('boxSizeValue').textContent = boxSize;
            document.getElementById('boxSizeValue2').textContent = boxSize;
            drawGrid();
            updateStats();
        }

        function loadImageFile() {
            document.getElementById('fileInput').click();
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        setupCanvases(this);
                        drawGrid();
                        updateStats();
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        function saveImage() {
            if (!originalImage) {
                alert('Bitte laden Sie zuerst ein Bild hoch!');
                return;
            }

            // Erstelle ein tempor√§res Canvas mit beiden Layern
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            
            tempCanvas.width = originalCanvas.width;
            tempCanvas.height = originalCanvas.height;
            
            // Zeichne das Originalbild
            tempCtx.drawImage(originalCanvas, 0, 0);
            
            // Zeichne das Grid dar√ºber
            tempCtx.drawImage(gridCanvas, 0, 0);
            
            // Speichere das Bild
            const link = document.createElement('a');
            link.download = 'kreuzstich-grid-vorlage.png';
            link.href = tempCanvas.toDataURL();
            link.click();
        }

        async function toggleWakeLock() {
            const btn = document.getElementById('wakeLockBtn');
            
            if (!('wakeLock' in navigator)) {
                alert('Wake Lock wird von diesem Browser nicht unterst√ºtzt');
                return;
            }

            try {
                if (wakeLock === null) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    btn.textContent = 'üîÜ Bildschirm aktiv';
                    btn.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                    
                    wakeLock.addEventListener('release', () => {
                        btn.textContent = 'üîÜ Bildschirm an lassen';
                        btn.style.background = 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)';
                        wakeLock = null;
                    });
                } else {
                    wakeLock.release();
                    wakeLock = null;
                }
            } catch (err) {
                console.error('Wake Lock Fehler:', err);
                alert('Bildschirm Wake Lock konnte nicht aktiviert werden');
            }
        }

        function updateStats() {
            if (!originalImage) {
                document.getElementById('imageWidth').textContent = '-';
                document.getElementById('imageHeight').textContent = '-';
                document.getElementById('gridColumns').textContent = '-';
                document.getElementById('gridRows').textContent = '-';
                document.getElementById('boxColumns').textContent = '-';
                document.getElementById('boxRows').textContent = '-';
                return;
            }

            const width = originalImage.width;
            const height = originalImage.height;
            const columns = Math.ceil(width / gridSize);
            const rows = Math.ceil(height / gridSize);
            const boxColumns = Math.ceil(columns / boxSize);
            const boxRows = Math.ceil(rows / boxSize);

            document.getElementById('imageWidth').textContent = width;
            document.getElementById('imageHeight').textContent = height;
            document.getElementById('gridColumns').textContent = columns;
            document.getElementById('gridRows').textContent = rows;
            document.getElementById('boxColumns').textContent = boxColumns;
            document.getElementById('boxRows').textContent = boxRows;
        }

        // Initialisiere beim Laden der Seite
        initializeCanvas();

        // Cleanup beim Schlie√üen der Seite
        window.addEventListener('beforeunload', () => {
            if (wakeLock !== null) {
                wakeLock.release();
            }
        });
    </script>
</body>
</html>
